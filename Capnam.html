<html lang="de">
<head>
<title> Capnam </title>
<meta charset='utf-8' />
<link rel="icon" type="image/x-icon" href="img/capnam.png">   <!-- favicon -->
</head>

<body onload="game = neuesLevel()">     <!-- Spielfeld erstellen ohne Knopfdruck und in der game Variable für später speichern-->
  <script src='js/Grid.js'></script>
  <script src='js/fields.js'></script>
  <script src='js/maze.js'></script>
  <script src='js/player.js'></script>

  <h1 class="intro">This is Capnam</h1>
  <h2 class="intro2">EAT collect REPEAT</h2>
  <br>
  <input type="text" value="" id="time" readonly >
  <br>
  <input type="text" id="zuege" value= "0 Zuege gemacht" readonly>
  <br>
  <canvas id='cvs' width='800px' height='800px' style="background-color:#0000ff ;border: 2px solid #000000;"></canvas>
  <br>
  <input type="number" id="dimensions" value="10" placeholder="neue größe?(Anzahl Felder)">   <!-- eine 10 für die automatische Levelgenerierung -->
  <button onclick="var eingabe = document.getElementById('dimensions').value; alert(eingabe +' Felder großes neues Spielfeld? Kommt sofort :)'); game = neuesLevel()">Erstellen</button>  <!-- jetzt: game=neuesLevel-->
  <input type="button" value="Test" onclick="game = neuesLevel()">  <!-- jetzt: game = neuesLevel-->
  <img src="img/capnam.png" style="display: none">

  <div id="footer">
       <p class="footer">- Created by Yannick Bauer</p>
  </div>
  
  <script>
var cvs = document.getElementById('cvs');
let ctx = cvs.getContext("2d");
//    alert ("Hier kurz die Regeln und Steuerung: \nBewegungen mit w,a,s,d auf der Tastatur\nZiel des Spiels: Überleben und viele Punkte machen")             //hier noch die genaueren Voraussetzungen einfügen



function neuesLevel()
     {
       clear(ctx);
       var dim = document.getElementById('dimensions').value;
       var grid = new Grid( cvs, dim );
       var maze = createMaze(grid);
       var player1 = new Player ( "player1", start_field, "#ff0000");
       grid.drawGrid(maze,player1);
       player1.drawPlayerPosition( grid );
       grid.drawFieldNumbers();

     }
function clear (ctx)
{
ctx.clearRect(0,0,ctx.canvas.width, ctx.canvas.height);
}

//StartZeit und aktuelle Zeit als Variablen
    var start_time = new Date().getTime();
    var current_time = new Date().getTime();

    function displayTime(input_field)
    {

    		current_time = new Date().getTime();


    		let delta_t = parseInt((current_time - start_time) / 1000);
    		let delta_m = parseInt( delta_t / 60);
    		let delta_s = delta_t % 60;

    		delta_m = delta_m < 10 ? ("0"+delta_m) : delta_m;
    		delta_s = delta_s < 10 ? ("0"+delta_s) : delta_s;

    		let zeittext =`Zeit ${delta_m}:${delta_s}`;
    		input_field.value = zeittext
    	}
setInterval (displayTime, 1000, document.getElementById('time'));







cvs.onkeydown = keyDown;
document.body.onkeydown = keyDown;




//keybindings
function keyDown( evt )
{
	let defined_keys = ["ArrowUp","ArrowRight", "ArrowDown" ,"ArrowLeft"]

	console.log( evt.key );


// hier habe ich einen bewegungs counter eingefügt (bewegung++) und der wird nur ausgeführt, wenn einer der definierten keys gedrückt wird.

	if ( defined_keys.includes( evt.key ) )
   {
		let direction = defined_keys.indexOf( evt.key ) ;
		player1.move( grid, direction );


// das html input feld mit der id "zuege" soll den Wert von bewegungen bekommen!!  id ansprechen
    document.getElementById('zuege').value = bewegungen + " Zuege gemacht";

// ... und in der Konsole ausgegeben
		console.log(bewegungen, " Zuege gemacht");
		evt.preventDefault();
	}
}


  </script>
  </body>
  </html>
